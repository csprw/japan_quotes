// The quotes to use
var quotes = [ "The mind is like a garden. Cultivate it well and you will reap the fruits of peace and happiness.", "Kindness is the language of the heart. Speak it fluently.","Happiness is not a destination, but a journey that begins with the decision to be grateful for what you have.","Let go of what no longer serves you and make space for what uplifts and nourishes you.","There is no need to search for happiness outside of ourselves. It is already within us, waiting to be discovered.","The present moment is a gift. That's why it's called the present.","The path to enlightenment is not about becoming someone else, but about unbecoming who you are not.","Don't let your fears hold you back. Embrace them and use them as stepping stones towards growth and transformation.","Compassion is not just a feeling, it's a practice. It requires action and dedication.","The most precious gift you can give someone is your time and attention.","The mind is a powerful tool. Use it wisely and it will work for you. Misuse it and it will work against you.","True wisdom is not in knowing everything, but in knowing that you know nothing.","Don't let your thoughts control you. You are the master of your mind, not the other way around.","Life is a journey of self-discovery. Enjoy the ride and learn from every experience.","Be gentle with yourself. You are doing the best you can with the knowledge and resources you have.","True freedom is not in doing whatever you want, but in letting go of the need to control and manipulate.","Gratitude is the antidote to fear and anxiety. Count your blessings and watch your worries disappear.","The greatest gift you can give yourself is the gift of self-love and self-acceptance.","The mind and body are not separate entities, but interconnected parts of the whole. Take care of both to achieve balance and harmony.","Forgiveness is not about forgetting, it's about letting go of the pain and resentment that keep you stuck in the past.","The universe is not separate from us, but a reflection of our own inner world. Change your thoughts, and you change your reality.","The journey to inner peace begins with acceptance of what is, without resistance or judgment.","Mindfulness is not a task to be done, but a way of being fully present in every moment.","Life is not a competition, but a collaboration. We are all in this together.","The greatest joy in life comes from giving, not receiving.","Your thoughts create your reality. Choose them wisely.","The only true failure is the failure to try.","Pain is inevitable, but suffering is optional. You have the power to choose how you respond to life's challenges.","True success is not in achieving external goals, but in living in alignment with your inner truth and values.","Love is not a feeling, but a practice. Cultivate it daily and watch it grow.","The most profound spiritual experiences often come from the simplest moments of life.","The mind is like a parachute. It works best when it's open.","There is no such thing as a perfect life, but there is such a thing as a perfectly imperfect life.","You are not your thoughts, emotions, or experiences. You are the awareness behind them.","Let go of the need to control everything and trust in the natural flow of life.","Nature is the ultimate teacher. Observe her lessons and learn from her wisdom.","The beauty of nature is not just in her appearance, but in the harmony and balance she creates.","We are not separate from nature, but an integral part of her ecosystem. Let's honor and protect her.","Just as the seasons change, so do our lives. Embrace the cycles of nature and flow with them.","In nature, there is no good or bad, just balance and harmony. Let's learn from her example and strive for balance in our lives.","Nature is not just a resource to be exploited, but a gift to be appreciated and cherished.","The more we connect with nature, the more we connect with ourselves and our true essence.","The beauty of nature is not in her grandeur, but in her simplicity and subtlety.","Every tree, every flower, every creature has its own unique story to tell. Listen to their wisdom and learn from their experiences.","The more we appreciate and care for nature, the more she will provide for us in return.","In nature, there is no hurry or worry, just a natural rhythm and flow. Let's learn from her pace and find peace in the present moment.","Nature is not just a physical environment, but a spiritual one as well. Connect with her energy and find inner peace.","The more we immerse ourselves in nature, the more we realize our interconnectedness with all beings.","The beauty of nature is not just in her colors and shapes, but in the feelings and emotions she evokes.","Nature is not just a place to visit, but a home to return to. Let's honor and protect her for future generations.","In nature, there are no judgments or prejudices, just acceptance and harmony. Let's learn from her example and strive for unity.","The more we appreciate the beauty and complexity of nature, the more we realize the beauty and complexity of ourselves.","In nature, there is no ego or selfishness, just a natural interdependence and symbiosis. Let's learn from her wisdom and strive for cooperation.","The more we connect with nature, the more we realize the impermanence and transience of all things. Let's embrace the present moment and cherish each experience.","Nature is not just a physical environment, but a spiritual guide as well. Follow her teachings and find your true path in life.","Letting go of the ego is like removing a veil that blocks our true vision.","The ego is like a prison that keeps us trapped in our own limitations.","True freedom comes from releasing the ego and embracing the present moment.","The ego seeks power and control, but true strength comes from letting go and surrendering to the flow of life.","The ego seeks validation and recognition, but true happiness comes from inner peace and contentment.","Letting go of the ego is not a loss, but a gain of our true identity.","The ego is like a mask that we wear, but true authenticity comes from being ourselves and letting go of pretense.","The ego creates separation and division, but true unity comes from letting go of differences and embracing our interconnectedness.","Letting go of the ego is not a one-time event, but a continuous practice of self-awareness and mindfulness.","The ego is like a shadow that follows us everywhere, but true enlightenment comes from shining a light on it and understanding its nature.","The ego creates fear and anxiety, but true courage comes from facing our fears and letting go of the need for control.","The ego seeks external validation, but true self-worth comes from recognizing our inherent value as human beings.","Letting go of the ego is not a sacrifice, but a liberation from the burden of our own expectations.","The ego seeks pleasure and comfort, but true fulfillment comes from embracing the challenges and growth opportunities of life.","The ego creates attachment and clinging, but true detachment comes from letting go of our desires and accepting what is.","Letting go of the ego is not a loss of identity, but a rediscovery of our true essence.","The ego creates conflict and competition, but true harmony comes from letting go of our need to prove ourselves.","The ego seeks permanence and stability, but true wisdom comes from accepting the impermanence and transience of all things.","Letting go of the ego is not a rejection of the self, but a realization of the interconnectedness of all beings.","The ego creates suffering and dissatisfaction, but true peace and contentment come from letting go of our attachments and embracing the present moment.","Change your behavior, change your life.","Your behavior today shapes your future tomorrow.","Changing your behavior requires a willingness to let go of old habits.","Real change starts with a decision to behave differently.","Small changes in behavior can lead to big improvements in life.","The power to change your behavior lies within you.","The first step to changing your behavior is awareness.","Consistency is key to changing your behavior.","Changing your behavior requires patience and persistence.","Changing your behavior is not easy, but it is worth it.","The most successful people are those who are willing to change their behavior.","Changing your behavior can be uncomfortable, but it leads to personal growth.","The path to change starts with taking small steps.","Changing your behavior requires a willingness to be vulnerable and open to new experiences.","Old patterns of behavior can be broken with the right mindset.","Changing your behavior requires a deep understanding of yourself and your triggers.","Real change happens when you stop making excuses and start taking action.","To change your behavior, you must first change your thoughts.","Change your behavior and you can change your world.","Changing your behavior is a lifelong journey, but it is one worth taking.","We are not separate from the world, but an integral part of it.","The universe is within us, and we are within the universe.","Our existence is intertwined with the fabric of the cosmos.","The world is a tapestry of interwoven threads, each one contributing to the whole.","We are threads in the tapestry of life, each with our own unique purpose.","Our actions have ripple effects that extend far beyond ourselves.","Our interconnectedness is what makes life meaningful.","We are all connected, like branches on a tree or waves in the ocean.","The world is a symphony, and we are each a note in the composition.","We are all part of a cosmic dance, moving in harmony with the rhythms of the universe.","Our connection to the world is what gives us purpose and meaning.","The world is a web of relationships, and we are each a node in the network.","Our experiences are shaped by the world around us, and we in turn shape the world.","The world is a canvas, and we are each a brushstroke in the masterpiece.","We are not observers of the world, but participants in its unfolding.","Our lives are like threads that weave together to create a beautiful tapestry.","The world is a garden, and we are each a unique flower that contributes to its beauty.","We are all part of the same story, each playing a unique role in its telling.","The world is a journey, and we are all fellow travelers on the road.","Our interconnectedness is what gives us hope, and the power to change the world.","Cultivate relationships to grow.","Remember your place in the whole.","Embrace humility, wear ego loosely.","Create a better future by being present.","Practice compassion, silence anger.","Expand your mind, connect with others.","Overcome inner demons, find peace.","Let the world shape your mind positively.","Cultivate true love through understanding.","Embrace change as a path to progress.","Find beauty in diversity, celebrate it.","Remember, your actions have impact.","Cherish and cultivate connections with others.","Be an active participant in shaping your life.","Weave your life with compassion and kindness.","Bloom with joy, find your inner peace.","Walk alongside others with kindness and empathy.","Work tirelessly for positive change.","Take time to appreciate the beauty of the world.","Choose your words carefully, they shape your reality.","Cultivate gratitude for what you have in life.","Be kind to yourself, forgive your mistakes.","Learn from your experiences, they hold valuable lessons.","Strive for balance in all areas of your life.","Practice self-reflection, it leads to self-awareness.","Cultivate inner peace through meditation or mindfulness.","Embrace vulnerability, it leads to deeper connections.","Choose your battles wisely, not everything is worth fighting for.","Practice empathy.","Act with integrity.","Embrace the unknown, it holds opportunities for growth.","Be open-minded, it leads to new perspectives.","Cultivate a sense of humor, it lightens the load.","Live in the present moment, it's where life happens.","Change is inevitable, embrace it with grace.","Believe in your ability to handle whatever changes come your way.","Embrace change as an opportunity for growth and self-discovery.","Without change, there is no progress.","Don't be afraid to make changes, it's better than staying stagnant.","Change your thoughts, change your reality.","Change your habits, change your life.","Small changes can lead to big results.","Embrace discomfort, it's a sign of growth and change.","Embrace uncertainty, it leads to new possibilities.","Change your perspective, it can transform your life.","Change your environment, it can impact your well-being.","Change your expectations, it leads to a more fulfilling life.","Change your priorities, it can improve your relationships.","Change your actions, it can change your outcomes.","Change your focus, it can lead to a more positive life.","Embrace change with acceptance and non-attachment.","Change is a natural part of life, let go of resistance.","Change your mind, change your world.","Seek change from within, it's the only lasting change.","Trust in the process of change, it leads to growth.","Change is an opportunity to practice compassion and kindness.","Embrace change with a beginner's mind, free from preconceptions.","Change your relationship with change.","Change can be uncomfortable, but it can also be transformative.","Change your thoughts","Change your behavior to cultivate inner peace and happiness.","Embrace change as a path to liberation and enlightenment.","Change your perception of yourself, see your innate Buddha-nature.","Change your reaction to change, choose mindfulness and equanimity.","Change your understanding of change, see it as an opportunity for growth.","Cultivate gratitude for the abundance in your life.","Practice self-compassion, forgive yourself and others.","Reflect on yourself, cultivate self-awareness and wisdom.","Embrace vulnerability, it brings deeper connections with others.","Choose your battles with mindfulness, not everything is worth fighting.","Practice empathy and compassion, cultivate loving-kindness towards all beings.","Believe in your innate potential for goodness and wisdom.","Embrace the unknown, it holds opportunities for growth and discovery.","Be open-minded and receptive to new perspectives and experiences.","Find purpose and meaning in your life, it gives direction and fulfillment.","Cultivate a sense of humor, it brings joy and lightness to life."];

// The faceAPI
const video = document.getElementById('video');
console.log("[Debug] video element created");

// On offline machines this would work:
// Promise.all([
//   faceapi.nets.tinyFaceDetector.loadFromUri('/models'),
//   faceapi.nets.faceLandmark68Net.loadFromUri('/models'),
//   faceapi.nets.faceRecognitionNet.loadFromUri('/models'),
//   faceapi.nets.faceExpressionNet.loadFromUri('/models')
// ]).then(startVideo)

// But since we use it online, we do it like this:
Promise.all([
  faceapi.nets.tinyFaceDetector.loadFromUri(
    "https://raw.githubusercontent.com/csprw/japan_quotes/master/models/"
  ),
  faceapi.nets.faceLandmark68Net.loadFromUri(
    "https://raw.githubusercontent.com/csprw/japan_quotes/master/models/"
  ),
  faceapi.nets.faceRecognitionNet.loadFromUri(
    "https://raw.githubusercontent.com/csprw/japan_quotes/master/models/"
  ),
  faceapi.nets.faceExpressionNet.loadFromUri(
    "https://raw.githubusercontent.com/csprw/japan_quotes/master/models/"
  ),
]).then(startVideo);


function startVideo() {
  navigator.getUserMedia(
    { video: {} },
    stream => video.srcObject = stream,
    err => console.error(err)
  );
  console.log("[Debug] video started");
}

video.addEventListener('play', () => {
  console.log("[debug] Video playing");

  // Add the canvas, so we can visualize bounding boxes
  const canvas = faceapi.createCanvasFromMedia(video);
  document.body.append(canvas)
  const displaySize = { width: video.width, height: video.height }
  faceapi.matchDimensions(canvas, displaySize)

  // Detect faces
  setInterval(async () => {
    // Detect the faces
    const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions()

    // Put bounding box over detections
    const resizedDetections = faceapi.resizeResults(detections, displaySize)
    canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)

    if (document.getElementById('boundingBox').checked) {
      faceapi.draw.drawDetections(canvas, resizedDetections);
    };
    if (document.getElementById('landmarks').checked) {
      faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);
    };
    if (document.getElementById('expression').checked) {
      faceapi.draw.drawFaceExpressions(canvas, resizedDetections);
    };

    // Jus draw everything
    // faceapi.draw.drawDetections(canvas, resizedDetections)
    // faceapi.draw.drawFaceLandmarks(canvas, resizedDetections)
    // faceapi.draw.drawFaceExpressions(canvas, resizedDetections)

    if (typeof detections !== 'undefined' && detections.length > 0) {
      // Face detected
      if (window.notDetectedDuration >= 1500) {
        var q = quotes[ Math.floor( Math.random() * quotes.length ) ];
        document.getElementById("theText").innerHTML = q;     
      }
      window.notDetectedDuration = 0;
    }
    else {
      // No faces detected
      console.log("No faces detected");
      if (window.notDetectedDuration >= 1500) {
        document.getElementById("theText").innerHTML = " ";     
      }
      window.notDetectedDuration += 100;
    }
   
  }, 100)
})

window.notDetectedDuration = 100;
var q = quotes[ Math.floor( Math.random() * quotes.length ) ];
document.getElementById("theText").innerHTML = q;   